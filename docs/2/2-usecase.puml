@startuml
title Activity — Планирование и выполнение рейса
skinparam defaultFontName "DejaVu Sans"
start

' Планирование
:Сбор статусов точек\n(заполненность, доступность, тара);
:Отбор кандидатов на сегодня;
:Запрос матрицы времени/расстояний у роутера;
:Построение оптимальных маршрутов\n(окна, ограничения ТС, объёмы);
:Назначение водителей и ТС;\nПубликация в приложении;

' Исполнение
:Водитель открывает смену (чек-лист, старт);
repeat
  :Переход к следующей точке;\nНавигация, геофенс;
  if (Точка доступна?) then (Да)
    :Операция на точке:\nсбор/замена тары;\nфиксация объёма/времени;
    :Синхронизация с ИС;
    if (ТС переполнено?) then (Да)
      :Досрочная сдача на объект;\nвзвешивание/приёмка;
      :Возврат к маршруту;
    endif
  else (Нет)
    :Запрос корректировки;\nперепланирование части маршрута;
    :Получение обновлённого плана;
  endif
repeat while (остались точки?)

:Финальная сдача на объект;\nвзвешивание/закрытие документа;
:Закрыть рейс и смену;\nОтчёт/начисления;
stop
@enduml
