@startuml
title Activity — Транспортировка (end-to-end)
skinparam defaultFontName "DejaVu Sans"
start

' Ночное планирование (ИС)
:Сбор статусов точек / остатки тары;
:Матрица времени/расстояний от маршрутизатора;
:Оптимизация: окна, ограничения ТС;
:Резерв тары/мощностей утилизации;
:Автоназначение водителей/ТС;\nПубликация планов в приложение;

' Исполнение рейса (водитель)
:Открыть смену (чек-лист, старт);
repeat
  :Навигация к следующей точке;\nприбытие (геофенс);
  if (Точка доступна?) then (Да)
    :Сбор/замена тары;\nфиксация объёма/массы;\nсинхронизация с ИС;
    if (ТС переполнено?) then (Да)
      :Промежуточная сдача на объект;\nвзвешивание/подтверждение;
      :Возврат к маршруту;
    endif
  else (Нет/инцидент)
    :Запрос корректировки (ИС);
    :Перепланирование участка;\nполучение нового плана;
  endif
repeat while (остались точки?)

:Финальная сдача на объект;\nзакрытие документов;
:Закрыть рейс и смену;\nОтчёт/начисления;
stop
@enduml
